<!DOCTYPE html>
<html>
<head>
     <meta charset="UTF-8">
     <meta http-equiv="X-UA-Compatible" content="IE=edge">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>Document</title>
     <style>
          #pager_area > button {
               border: 0; background-color: white; border-radius: 50%;
               width: 20px; height: 20px; margin: 3px;
               color:gray; cursor:pointer
          }    
          #pager_area> button:hover{color:white; background-color: gray;}
          #pager_area> button.current{
               font-weight: bold;
               color: white; background-color: black;
          }
          #genre_add_wrap {display: none;}
     </style>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.2.6/axios.min.js" integrity="sha512-RUkwGPgBmjCwqXpCRzpPPmGl0LSFp9v5wXtmG41+OS8vnmXybQX5qiG5adrIhtO03irWCXl+z0Jrst6qeaLDtQ==" crossorigin="anonymous" referrerpolicy="no-referrer"> 
     </script>
     <!-- <script>
          document.addEventListener("DOMContentLoaded", function(){
               let userInfo = sessionStorage.getItem("user")
               console.log(userInfo)
               if(userInfo == null || userInfo == undefined){
                    alert("로그인이 필요한 서비스입니다.")
                    location.href="/login.html"
               }
               userInfo = JSON.parse(userInfo)
               document.getElementById("id").innerHTML = userInfo.miId
               document.getElementById("name").innerHTML = "("+ userInfo.miName +")"
               document.getElementById("logout").addEventListener("click",function(){
                    sessionStorage.removeItem("user")
                    location.href = "/login.html";
               })
          })
     </script> -->
     <script>
          function elemId(id){
               return document.getElementById(id);
          }
          document.addEventListener("DOMContentLoaded", function(){
               document.getElementById("genre_popup_btn").addEventListener("click", function(){
                    document.getElementById("genre_add_wrap").style.display="block"
               })
               elemId("genre_add_form").addEventListener("submit",(e) => { e.preventDefault() })
               elemId("genre_add_btn").addEventListener("click", function(){
                    let name = elemId("genre_name").value
                    // alert(name)
                    axios.put("http://localhost:8585/api/genre/add?name="+name)
                    .then((result)=>{ //성공 (응답코드 100~399)
                         console.log(result)
                         if(result.data.status){
                              alert(result.data.message)
                              elemId("genre_add_wrap").style.display="";
                              loadGenreList();
                              elemId("genre_name").value="";
                         }else{
                              elemId("add_err_msg").innerHTML = result.data.message
                         }
                    })
                    .catch((error)=>{ //실패 (응답코드 400~599)
                         console.log(error)
                    })
               })
               loadGenreList()
               document.getElementById("search_area").addEventListener("submit", function(event){
                    event.preventDefault();
                    //form태그의 요청 기능을 제거하는 코드. 
                    //검색 시 enter단축키 사용을 위해 div에서 form으로 변경한 뒤 기본으로 설정된 요청기능을 삭제한거임
               })
               document.getElementById("search").addEventListener("click", function(){
                    const keyword = document.getElementById("keyword").value
                    loadGenreList(0,keyword)
               })
          })
          function deleteCategory(no){
               if(!confirm("카테고리를 삭제하시겠습니까?")) return
               axios.delete("http://localhost:8585/api/genre/delete?genre_no="+no) //DeleteMapping
               .then(function(result){
                    alert(result.data.message)
                    loadGenreList()
               })
          }
          function loadGenreList(page, keyword){
               if(page==null || page ==undefined){ //undefined - 아직 정의되지않음
                    page=0
               }
               if(keyword==null || keyword==undefined){
                    keyword=""
               }
               axios.get("http://localhost:8585/api/genre/list?page="+page+"&keyword="+keyword) //GetMapping
               .then(function(result){
                    console.log(result)
                    const genreList =result.data.list
                    let tbody_content=""
                    for(let i=0;i<genreList.length;i++){
                         tbody_content+=
                         '<tr>'+
                              '<td>'+genreList[i].genreSeq+'</td>'+
                              '<td>'+
                                   '<a href="#">'+genreList[i].genreName+'</a>'+
                              '<td>'+
                                   '<button onclick="deleteCategory('+genreList[i].genreSeq+')">삭제</button>'+
                              '</td>'+
                         '</tr>'
                    }
                    document.querySelector("#list_table>tbody").innerHTML = tbody_content
                    const totalPage = result.data.totalPage
                    const currentPage = result.data.currentPage
                    let pager_content = "";
                    for(let i=0;i<totalPage;i++){
                         if(i==currentPage){
                              pager_content+='<button class="current" onclick="loadGenreList('+i+')">'+(i+1)+'</button>'
                         }else{
                              pager_content+='<button onclick="loadGenreList('+i+')">'+(i+1)+'</button>'
                         }
                    }
                    document.getElementById("pager_area").innerHTML = pager_content
               })
          }
     </script>
</head>
<body>
     <header id="header">
          <!-- div>(span#id+span#name+button#logout{로그아웃}) --> <!--emmet autocomplete 단축어 -->
          <div>
               <span id="id"></span><span id="name"></span>님
               <button id="logout">로그아웃</button></div>
     </header>
     <br>
     <button id="genre_popup_btn">장르정보 추가</button>
     <table id="list_table">
          <thead>
               <tr>
                    <th>번호</th>
                    <th>장르명</th>
               </tr>
          </thead>
          <tbody>
               <tr>
                    <td>123</td>
                    <td>
                         <a href="#">장르이름</a>
                    <td>
                         <button>삭제</button>
                    </td>
               </tr>
          </tbody>
     </table>
     <br>
     <form id="search_area">
          <input type="text" id="keyword">
          <button id="search">검색</button>
     </form>
     <br>
     <div id="pager_area">
          
     </div>
     <!-- #genre_add_wrap>#genre_add>(h2+form#genre_add_form>(input#genre_name+p#add_err_msg+button#genre_add_btn)) --> <!-- 아래 form만드는 단축키 -->
     <div id="genre_add_wrap">
          <div id="genre_add">
               <h3>장르정보 추가</h3>
               <form id="genre_add_form">
                    <input type="text" id="genre_name">
                    <p id="add_err_msg"></p>
                    <button id="genre_add_btn">추가</button>
               </form>
          </div>
     </div>
</body>
</html>